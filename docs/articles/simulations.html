<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulating methylation data by convoluting cell type-specific methylation profiles. • medepir</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Simulating methylation data by convoluting cell type-specific methylation profiles.">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">medepir</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/deconvolution.html">Estimating cell-type composition accounting for confounder variables. </a>
    </li>
    <li>
      <a href="../articles/simulations.html">Simulating methylation data by convoluting cell type-specific methylation profiles.</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Simulating methylation data by convoluting cell type-specific methylation profiles.</h1>
                        <h4 class="author">Michael Blum, Clémentine Decamps, Florian Privé, Magali Richard</h4>
            
            <h4 class="date">June 27, 2019</h4>
      
      
      <div class="hidden name"><code>simulations.Rmd</code></div>

    </div>

    
    
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>To simulate the T matrix of cell type-specific methylation profiles, we use different studies from GEO. For the cancerous epithelial line, we use the cell line GSM1560930 and for the cancerous mesenchymal line, we use the cell line GSM1560925 from the same study. For the fibroblast line, we use the cell line GSM1354676 after conversion from m-value to b-value. For the T cell line, we use the GSM1641099 and for the control epithelial cell, we use the GSM2743808.</p>
<p><code>plate_effect</code> contains 22 median plate effects (TCGA experimental batch effect) for 1000 random probes. For each probe, we model plate effects using multiplicative coefficients that measure the ratio of mean methylation values of a plate on mean methylation of the (arbitrarily) 1st plate. Each coefficient is estimated by the median of the 1000 ratios of methylation values. These multiplicative coefficients are then used on all probes to model batch effects on the matrix D of individual convoluted methylation profiles.</p>
<p><code>sites_sexe</code> indicates the 1397 probes that are correlated with sex in the TCGA dataset. <code>sites_sexe</code> contains the linear regression coefficients used to shift methylation value of female-associated T matrices.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">T_brute =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readRDS">readRDS</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"https://zenodo.org/record/3247635/files/T_brut_2.rds"</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(T_brute)</code></pre></div>
<pre><code>##              data_fib  data_epit data_lymph data_epit_ctrl   data_mes
## cg00000292 0.71128608 0.95267309 0.87396160     0.36933064 0.90817439
## cg00002426 0.42943911 0.07660021 0.89707360     0.08261418 0.03621291
## cg00003994 0.06596913 0.04783730 0.09655583     0.14852395 0.02077592
## cg00005847 0.13941766 0.89655738 0.20705830     0.32145031 0.86761018
## cg00007981 0.06315487 0.01952210 0.03124379     0.06667628 0.01059850
## cg00008493 0.97435463 0.98140307 0.88127190     0.87061069 0.99020340</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plate_effect =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readRDS">readRDS</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"https://zenodo.org/record/3247635/files/plate_effect.rds"</span>))
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(plate_effect)</code></pre></div>
<pre><code>##   plates    effect
## 1   0752 1.0000000
## 2   0945 0.7727658
## 3   1104 0.9788447
## 4   1205 0.9082106
## 5   1626 1.2996661
## 6   1756 1.5209063</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sex_reg =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readRDS">readRDS</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">url</a></span>(<span class="st">"https://zenodo.org/record/3247635/files/regression_sexe.rds"</span>))
coeff_luad =<span class="st"> </span>sex_reg<span class="op">$</span>luad
coeff_lusc =<span class="st"> </span>sex_reg<span class="op">$</span>lusc
sites_sexe =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(coeff_luad)[coeff_luad[<span class="dv">8</span>,] <span class="op">&lt;</span><span class="st"> </span>(<span class="fl">0.01</span>) <span class="op">|</span><span class="st"> </span>coeff_lusc[<span class="dv">8</span>,] <span class="op">&lt;</span><span class="st"> </span>(<span class="fl">0.01</span>)]
coeff_sexe =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/apply">apply</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">cbind</a></span>(coeff_luad[<span class="dv">2</span>, ], coeff_lusc[<span class="dv">2</span>, ]), <span class="dv">1</span>, mean)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(sites_sexe)</code></pre></div>
<pre><code>## [1] "cg00012386" "cg00029931" "cg00121904" "cg00126657" "cg00126698"
## [6] "cg00128197"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(coeff_sexe)</code></pre></div>
<pre><code>##   cg00000292   cg00002426   cg00003994   cg00005847   cg00007981 
## -0.014126006 -0.017183944  0.002714856 -0.007344126  0.002157294 
##   cg00008493 
## -0.005986481</code></pre>
</div>
<div id="simulation-of-a-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-of-a-matrix" class="anchor"></a>Simulation of A matrix</h2>
<p>The function <code>compute_A</code> simulates the A matrix of cell types proportion using a Dirichlet distribution. <code>n</code> is the number of patients, <code>prop</code> define the different cell type proportions (here it is 10% for fibroblast, 60% for cancerous epithelial, 5% for T cells, 15% for control epithelial and 10% for cancerous mesenchyme cells). <code>alpha</code> is equal to the sum of the parameter of the Dirichlet distribution. It is inversely related to variation of proportions in the population. In the simulations, we choose <code>alpha=1</code> that corresponds to a population with variable proportions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">A &lt;-<span class="st"> </span>medepir<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/medepir/topics/compute_A">compute_A</a></span>(<span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">prop =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.1</span>, <span class="fl">0.6</span>, <span class="fl">0.05</span>, <span class="fl">0.15</span>, <span class="fl">0.1</span>), <span class="dt">alpha =</span> <span class="dv">1</span>)

<span class="co"># plot histogram of proportion for each cell type</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(A) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"fibroblast"</span>, <span class="st">"cancerous epithelial"</span>, <span class="st">"T-cells"</span>, <span class="st">"epithelial"</span>, <span class="st">"cancerous mesenchyme"</span>)
dat &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">as.data.frame.table</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(A))
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(dat) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"indiv"</span>, <span class="st">"cell_type"</span>, <span class="st">"proportion"</span>)
ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(dat, ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="dt">x =</span> proportion)) <span class="op">+</span><span class="st"> </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span>(<span class="dt">colour =</span> <span class="st">"black"</span>, <span class="dt">fill =</span> <span class="st">"white"</span>, <span class="dt">binwidth =</span> <span class="fl">0.025</span>) <span class="op">+</span>
<span class="st">  </span>ggplot2<span class="op">::</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(cell_type <span class="op">~</span><span class="st"> </span>.)</code></pre></div>
<p><img src="simulations_files/figure-html/simulation_A-1.png" width="576"></p>
</div>
<div id="simulation-of-d-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#simulation-of-d-matrix" class="anchor"></a>Simulation of D matrix</h2>
<p>The function <code>create_exp_grp</code> makes a random experimental dataset. It samples randomly the plate, the sex and/or the age of each patient.</p>
<p>The function <code>compute_D</code> allows to obtain the D matrix according to the D = TA model with all the confounding factors. The sex effect is added directly to the T matrix, while the plate effect is added after matrix multiplication.</p>
<p>Finally, the function <code>add_noise</code> add a random gaussian noise to the D matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exp_grp =<span class="st"> </span>medepir<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/medepir/topics/create_exp_grp">create_exp_grp</a></span>(<span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">plates =</span> plate_effect[, <span class="dv">1</span>], 
                                  <span class="dt">sex =</span> <span class="ot">TRUE</span>, <span class="dt">age =</span> <span class="ot">FALSE</span>)

D =<span class="st"> </span>medepir<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/medepir/topics/compute_D">compute_D</a></span>(<span class="dt">A_mat =</span> A, <span class="dt">T_mat =</span> T_brute, exp_grp, <span class="dt">sites_sex =</span> sites_sexe, 
              <span class="dt">coeff_sex =</span> coeff_sexe, <span class="dt">plate_effect =</span> plate_effect)

D_noise =<span class="st"> </span>medepir<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/medepir/topics/add_noise">add_noise</a></span>(<span class="dt">data =</span> D, <span class="dt">mean =</span> <span class="dv">0</span>)</code></pre></div>
</div>
<div id="deconvolution-of-the-d-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#deconvolution-of-the-d-matrix" class="anchor"></a>Deconvolution of the D matrix</h2>
<p>We use the package RefFreeEwas to make the deconvolution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results_RFE =<span class="st"> </span>medepir<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/medepir/topics/RFE">RFE</a></span>(D_noise, <span class="dt">nbcell =</span> <span class="dv">5</span>)</code></pre></div>
<pre><code>## The "ward" method has been renamed to "ward.D"; note new "ward.D2"</code></pre>
<pre><code>##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## 1.100e-07 3.369e-03 7.839e-03 1.200e-02 1.590e-02 1.847e-01 
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 0.000000 0.002129 0.004847 0.008314 0.010207 0.241378 
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 0.000000 0.001689 0.003922 0.007316 0.008809 0.182657 
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 0.000000 0.001312 0.003136 0.006166 0.007526 0.132185 
##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
## 0.000000 0.001022 0.002461 0.004864 0.006089 0.086963 
##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## 0.0000000 0.0008693 0.0021303 0.0041804 0.0052788 0.0658586 
##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## 0.0000000 0.0008376 0.0020387 0.0039829 0.0049940 0.0701684 
##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## 0.0000000 0.0008229 0.0019917 0.0038808 0.0047531 0.0721993 
##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
## 0.0000000 0.0007939 0.0019125 0.0037288 0.0044946 0.0696782</code></pre>
</div>
<div id="analysis-of-the-results" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-of-the-results" class="anchor"></a>Analysis of the results</h2>
<p>The function <code>compare_A</code> computes the Mean Absolute Error between the A matrix used for the simulation and the A matrix computed by the method of deconvolution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">medepir<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/medepir/topics/compare_A">compare_A</a></span>(<span class="dt">A_r =</span> A, <span class="dt">A_est =</span> results_RFE<span class="op">$</span>A)</code></pre></div>
<pre><code>## [1] 0.08228577</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#data">Data</a></li>
      <li><a href="#simulation-of-a-matrix">Simulation of A matrix</a></li>
      <li><a href="#simulation-of-d-matrix">Simulation of D matrix</a></li>
      <li><a href="#deconvolution-of-the-d-matrix">Deconvolution of the D matrix</a></li>
      <li><a href="#analysis-of-the-results">Analysis of the results</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Clémentine Decamps, Florian Privé, Michael Blum, Magali Richard.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
